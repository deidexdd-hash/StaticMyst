/**
 * РАСШИРЕННАЯ СИСТЕМА ПРАКТИК
 * Полная интеграция с матрицей судьбы и персонализированные рекомендации
 */

class PracticesEnhanced {
    constructor(knowledgeBase) {
        this.kb = knowledgeBase;
        this.userMatrix = null;
        this.birthDate = null;
    }

    // Установка матрицы пользователя
    setUserMatrix(matrix, birthDate) {
        this.userMatrix = matrix;
        this.birthDate = birthDate;
    }

    // Главная функция: получить персонализированные практики
    getPersonalizedPractices() {
        if (!this.userMatrix) {
            return this.getAllPracticesStructured();
        }

        const analysis = this.analyzeMatrix();
        const practices = {
            urgent: this.getUrgentPractices(analysis),
            recommended: this.getRecommendedPractices(analysis),
            supportive: this.getSupportivePractices(analysis),
            all: this.getAllPracticesStructured()
        };

        return practices;
    }

    // Анализ матрицы для подбора практик
    analyzeMatrix() {
        const analysis = {
            emptyNumbers: [],      // Отсутствующие качества
            excessNumbers: [],     // Избыточные качества
            birthNumber: null,     // Число рождения
            lifePath: null,        // Число жизненного пути
            karmicDebts: [],       // Кармические долги
            ancestralIssues: [],   // Родовые проблемы
            weakPlanes: []         // Слабые планы
        };

        // Пустые ячейки (отсутствующие числа)
        for (let i = 1; i <= 9; i++) {
            const count = this.userMatrix.matrix_counts[i] || 0;
            if (count === 0) {
                analysis.emptyNumbers.push({
                    number: i,
                    quality: this.getQualityName(i),
                    severity: 'high'
                });
            } else if (count > 5) {
                analysis.excessNumbers.push({
                    number: i,
                    quality: this.getQualityName(i),
                    count: count
                });
            }
        }

        // Число рождения
        const day = parseInt(this.birthDate.split('.')[0]);
        analysis.birthNumber = day <= 9 ? day : this.sumDigits(day);

        // Число жизненного пути
        const parts = this.birthDate.split('.');
        const sum = parseInt(parts[0]) + parseInt(parts[1]) + parseInt(parts[2]);
        analysis.lifePath = this.sumDigits(sum);

        // Кармические долги (13, 14, 16, 19)
        const fullArray = this.userMatrix.full_array || [];
        const yearSum = this.sumDigits(parseInt(parts[2]));
        if ([13, 14, 16, 19].includes(yearSum) || 
            [13, 14, 16, 19].includes(sum % 100)) {
            analysis.karmicDebts.push(yearSum);
        }

        // Анализ планов (ментальный, физический, эмоциональный)
        const planes = this.analyzePlanes();
        analysis.weakPlanes = planes.filter(p => p.strength < 3);

        return analysis;
    }

    // Анализ планов (линий) матрицы
    analyzePlanes() {
        const counts = this.userMatrix.matrix_counts || {};
        
        return [
            {
                name: 'Ментальный',
                numbers: [1, 4, 7],
                strength: (counts[1] || 0) + (counts[4] || 0) + (counts[7] || 0),
                description: 'Ум, логика, мышление'
            },
            {
                name: 'Физический', 
                numbers: [3, 6, 9],
                strength: (counts[3] || 0) + (counts[6] || 0) + (counts[9] || 0),
                description: 'Тело, действия, реализация'
            },
            {
                name: 'Эмоциональный',
                numbers: [2, 5, 8],
                strength: (counts[2] || 0) + (counts[5] || 0) + (counts[8] || 0),
                description: 'Чувства, интуиция, энергия'
            }
        ];
    }

    // СРОЧНЫЕ ПРАКТИКИ (для критических проблем)
    getUrgentPractices(analysis) {
        const urgent = [];

        // Для пустых ячеек - развитие отсутствующих качеств
        analysis.emptyNumbers.forEach(item => {
            urgent.push({
                type: 'development',
                priority: 'urgent',
                title: `Развитие ${item.quality}`,
                number: item.number,
                duration: '21 день',
                practices: this.getPracticesForNumber(item.number, 'development')
            });
        });

        // Для кармических долгов
        analysis.karmicDebts.forEach(debt => {
            urgent.push({
                type: 'karmic',
                priority: 'urgent',
                title: `Отработка кармического долга ${debt}`,
                number: debt,
                duration: '40 дней',
                practices: this.getKarmicPractices(debt)
            });
        });

        // Для слабых планов
        analysis.weakPlanes.forEach(plane => {
            if (plane.strength === 0) {
                urgent.push({
                    type: 'plane',
                    priority: 'urgent',
                    title: `Укрепление ${plane.name.toLowerCase()} плана`,
                    description: plane.description,
                    duration: '30 дней',
                    practices: this.getPracticesForPlane(plane.name)
                });
            }
        });

        return urgent;
    }

    // РЕКОМЕНДОВАННЫЕ ПРАКТИКИ (для оптимизации)
    getRecommendedPractices(analysis) {
        const recommended = [];

        // Для числа рождения - раскрытие потенциала
        recommended.push({
            type: 'potential',
            priority: 'recommended',
            title: `Раскрытие потенциала числа ${analysis.birthNumber}`,
            number: analysis.birthNumber,
            duration: '21 день',
            practices: this.getPracticesForNumber(analysis.birthNumber, 'potential')
        });

        // Для жизненного пути - реализация предназначения
        recommended.push({
            type: 'purpose',
            priority: 'recommended',
            title: `Реализация жизненного пути ${analysis.lifePath}`,
            number: analysis.lifePath,
            duration: '40 дней',
            practices: this.getPracticesForNumber(analysis.lifePath, 'purpose')
        });

        // Балансировка избыточных качеств
        analysis.excessNumbers.forEach(item => {
            recommended.push({
                type: 'balance',
                priority: 'recommended',
                title: `Балансировка ${item.quality}`,
                number: item.number,
                description: `У вас ${item.count} ${item.quality} - важно научиться управлять этой энергией`,
                duration: '14 дней',
                practices: this.getPracticesForNumber(item.number, 'balance')
            });
        });

        return recommended;
    }

    // ПОДДЕРЖИВАЮЩИЕ ПРАКТИКИ (для гармонизации)
    getSupportivePractices(analysis) {
        const supportive = [];

        // Общие родовые практики
        supportive.push({
            type: 'ancestral',
            priority: 'supportive',
            title: 'Работа с Родом',
            duration: '9 дней',
            practices: this.getAncestralPractices()
        });

        // Практики для усиления слабых планов
        analysis.weakPlanes.forEach(plane => {
            if (plane.strength > 0 && plane.strength < 3) {
                supportive.push({
                    type: 'plane',
                    priority: 'supportive',
                    title: `Усиление ${plane.name.toLowerCase()} плана`,
                    description: plane.description,
                    duration: '21 день',
                    practices: this.getPracticesForPlane(plane.name)
                });
            }
        });

        // Практики для денежного потока
        supportive.push({
            type: 'abundance',
            priority: 'supportive',
            title: 'Привлечение изобилия',
            duration: '40 дней',
            practices: this.getAbundancePractices()
        });

        return supportive;
    }

    // Получить практики для конкретного числа
    getPracticesForNumber(number, type) {
        const practicesMap = {
            1: {
                development: [
                    {
                        name: 'Медитация лидера',
                        description: 'Ежедневная практика для развития лидерских качеств, уверенности и силы воли',
                        duration: '15 минут',
                        frequency: 'Ежедневно утром',
                        steps: [
                            'Сядьте в удобную позу, спина прямая',
                            'Представьте себя в роли уверенного лидера',
                            'Почувствуйте силу и авторитет внутри себя',
                            'Визуализируйте, как вы принимаете важные решения',
                            'Скажите аффирмацию: "Я - сильный лидер, я принимаю ответственность"'
                        ]
                    },
                    {
                        name: 'Практика решительности',
                        description: 'Развитие навыка быстрого принятия решений',
                        duration: 'В течение дня',
                        frequency: 'При каждом выборе',
                        steps: [
                            'При любом выборе давайте себе максимум 30 секунд',
                            'Принимайте решение и действуйте',
                            'Не возвращайтесь к сомнениям',
                            'Берите ответственность за результат'
                        ]
                    }
                ],
                potential: [
                    {
                        name: 'Раскрытие внутренней силы',
                        description: 'Глубокая медитация для активации лидерского потенциала',
                        duration: '30 минут',
                        frequency: 'Ежедневно вечером',
                        steps: [
                            'Создайте спокойное пространство',
                            'Зажгите красную свечу (цвет числа 1)',
                            'Медитируйте на пламя, представляя свою внутреннюю силу',
                            'Почувствуйте, как сила наполняет каждую клетку тела',
                            'Запишите инсайты о своей миссии'
                        ]
                    }
                ],
                balance: [
                    {
                        name: 'Практика смирения',
                        description: 'Балансировка избыточной энергии лидерства',
                        duration: '20 минут',
                        frequency: '3 раза в неделю',
                        steps: [
                            'Признайте, что вы не всегда правы',
                            'Практикуйте активное слушание других',
                            'Делегируйте задачи, доверяйте команде',
                            'Благодарите других за вклад'
                        ]
                    }
                ]
            },
            2: {
                development: [
                    {
                        name: 'Медитация гармонии',
                        description: 'Развитие дипломатических способностей и чувствительности',
                        duration: '15 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Настройтесь на чувство внутреннего мира',
                            'Представьте, как вы находите общий язык с людьми',
                            'Почувствуйте энергию сотрудничества',
                            'Повторяйте: "Я легко нахожу компромисс"'
                        ]
                    },
                    {
                        name: 'Практика границ',
                        description: 'Обучение говорить "нет" и защищать свои интересы',
                        duration: 'В течение дня',
                        frequency: 'При необходимости',
                        steps: [
                            'Определите свои истинные потребности',
                            'Практикуйте отказ без чувства вины',
                            'Учитесь отстаивать свою позицию мягко, но твердо'
                        ]
                    }
                ],
                potential: [
                    {
                        name: 'Раскрытие интуиции',
                        description: 'Активация интуитивных способностей для принятия решений',
                        duration: '25 минут',
                        frequency: 'Ежедневно вечером',
                        steps: [
                            'Зажгите оранжевую свечу',
                            'Настройтесь на внутренний голос',
                            'Задавайте вопросы и слушайте ответы изнутри',
                            'Доверяйте первому впечатлению'
                        ]
                    }
                ],
                balance: [
                    {
                        name: 'Практика уверенности',
                        description: 'Преодоление излишней зависимости от чужого мнения',
                        duration: '15 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Примите решение без консультации с другими',
                            'Сделайте что-то только для себя',
                            'Повторяйте: "Я ценен сам по себе"'
                        ]
                    }
                ]
            },
            3: {
                development: [
                    {
                        name: 'Медитация творчества',
                        description: 'Раскрытие творческого потенциала и креативности',
                        duration: '20 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Настройтесь на творческую энергию',
                            'Представьте поток идей, льющийся в вас',
                            'Визуализируйте себя создающим нечто прекрасное',
                            'Аффирмация: "Я - творец своей реальности"'
                        ]
                    },
                    {
                        name: 'Практика радости',
                        description: 'Возвращение к спонтанности и легкости',
                        duration: 'В течение дня',
                        frequency: 'Постоянно',
                        steps: [
                            'Делайте что-то неожиданное каждый день',
                            'Танцуйте, пойте, смейтесь без причины',
                            'Играйте, как ребенок'
                        ]
                    }
                ],
                potential: [
                    {
                        name: 'Активация третьего глаза',
                        description: 'Глубокая медитация для раскрытия экстрасенсорных способностей',
                        duration: '30 минут',
                        frequency: 'Ежедневно вечером',
                        steps: [
                            'Зажгите желтую свечу',
                            'Сфокусируйтесь на точке между бровей',
                            'Представляйте открывающийся портал знаний',
                            'Принимайте образы и символы'
                        ]
                    }
                ],
                balance: [
                    {
                        name: 'Практика фокуса',
                        description: 'Концентрация энергии на важном',
                        duration: '20 минут',
                        frequency: '3 раза в неделю',
                        steps: [
                            'Выберите одну цель',
                            'Уберите все отвлекающие факторы',
                            'Работайте над целью 25 минут без перерыва',
                            'Доводите начатое до конца'
                        ]
                    }
                ]
            },
            4: {
                development: [
                    {
                        name: 'Медитация стабильности',
                        description: 'Укрепление внутренней опоры и дисциплины',
                        duration: '15 минут',
                        frequency: 'Ежедневно утром',
                        steps: [
                            'Почувствуйте связь с землей',
                            'Представьте себя крепким фундаментом',
                            'Ощутите стабильность и надежность',
                            'Повторяйте: "Я создаю прочную основу"'
                        ]
                    },
                    {
                        name: 'Практика структуры',
                        description: 'Создание порядка в жизни',
                        duration: '30 минут',
                        frequency: 'Еженедельно',
                        steps: [
                            'Составьте четкий план на неделю',
                            'Разбейте большие цели на маленькие шаги',
                            'Следуйте распорядку дня'
                        ]
                    }
                ],
                potential: [
                    {
                        name: 'Проводник знаний',
                        description: 'Раскрытие способности структурировать и передавать знания',
                        duration: '40 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Зажгите зеленую свечу',
                            'Медитируйте на тему знания, которое хотите передать',
                            'Представьте, как люди получают пользу от ваших знаний',
                            'Запишите структуру обучения'
                        ]
                    }
                ],
                balance: [
                    {
                        name: 'Практика гибкости',
                        description: 'Преодоление излишней жесткости',
                        duration: '15 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Сделайте что-то спонтанное',
                            'Позвольте себе отклониться от плана',
                            'Примите неопределенность',
                            'Учитесь адаптироваться'
                        ]
                    }
                ]
            },
            5: {
                development: [
                    {
                        name: 'Медитация свободы',
                        description: 'Раскрытие внутренней свободы и независимости',
                        duration: '20 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Почувствуйте абсолютную свободу',
                            'Представьте себя без ограничений',
                            'Ощутите легкость и текучесть',
                            'Аффирмация: "Я свободен выбирать"'
                        ]
                    },
                    {
                        name: 'Практика изменений',
                        description: 'Развитие гибкости и адаптивности',
                        duration: 'В течение дня',
                        frequency: 'Постоянно',
                        steps: [
                            'Меняйте привычный маршрут',
                            'Пробуйте новое каждый день',
                            'Приветствуйте неожиданности',
                            'Адаптируйтесь быстро'
                        ]
                    }
                ],
                potential: [
                    {
                        name: 'Путешественник миров',
                        description: 'Активация способности свободно перемещаться между сферами жизни',
                        duration: '35 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Зажгите синюю свечу',
                            'Медитируйте на образ путешественника',
                            'Представляйте разные пути и возможности',
                            'Чувствуйте свободу выбора'
                        ]
                    }
                ],
                balance: [
                    {
                        name: 'Практика ответственности',
                        description: 'Обучение следовать обязательствам',
                        duration: '20 минут',
                        frequency: '3 раза в неделю',
                        steps: [
                            'Возьмите на себя обязательство',
                            'Доведите дело до конца',
                            'Не убегайте при первых трудностях',
                            'Цените стабильность'
                        ]
                    }
                ]
            },
            6: {
                development: [
                    {
                        name: 'Медитация любви',
                        description: 'Раскрытие сердечной чакры и безусловной любви',
                        duration: '20 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Положите руку на сердце',
                            'Почувствуйте тепло и любовь',
                            'Направьте эту любовь к себе и близким',
                            'Повторяйте: "Я достоин любви"'
                        ]
                    },
                    {
                        name: 'Практика служения',
                        description: 'Развитие навыка заботы о других',
                        duration: 'В течение дня',
                        frequency: 'Постоянно',
                        steps: [
                            'Совершайте добрые дела без ожидания',
                            'Помогайте близким',
                            'Создавайте уют и красоту вокруг'
                        ]
                    }
                ],
                potential: [
                    {
                        name: 'Хранитель очага',
                        description: 'Активация родовой силы создания гармоничного пространства',
                        duration: '30 минут',
                        frequency: 'Ежедневно вечером',
                        steps: [
                            'Зажгите розовую свечу',
                            'Медитируйте на образ гармоничного дома',
                            'Почувствуйте себя центром семьи',
                            'Благословите свое пространство'
                        ]
                    }
                ],
                balance: [
                    {
                        name: 'Практика принятия несовершенства',
                        description: 'Преодоление перфекционизма',
                        duration: '15 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Примите, что не все должно быть идеально',
                            'Отпустите контроль над деталями',
                            'Цените процесс, а не только результат'
                        ]
                    }
                ]
            },
            7: {
                development: [
                    {
                        name: 'Медитация мудрости',
                        description: 'Развитие духовного зрения и глубокого понимания',
                        duration: '30 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Войдите в глубокую медитацию',
                            'Задайте вопрос высшему Я',
                            'Слушайте тишину',
                            'Принимайте знания из глубины души'
                        ]
                    },
                    {
                        name: 'Практика познания',
                        description: 'Постоянное обучение и развитие',
                        duration: 'В течение дня',
                        frequency: 'Ежедневно',
                        steps: [
                            'Изучайте что-то новое каждый день',
                            'Анализируйте и размышляйте',
                            'Ищите скрытый смысл в событиях'
                        ]
                    }
                ],
                potential: [
                    {
                        name: 'Проводник духовности',
                        description: 'Раскрытие способности работать с энергиями и вести других',
                        duration: '45 минут',
                        frequency: 'Ежедневно вечером',
                        steps: [
                            'Зажгите фиолетовую свечу',
                            'Медитируйте на связь с высшими силами',
                            'Представьте себя проводником света',
                            'Примите духовную миссию'
                        ]
                    }
                ],
                balance: [
                    {
                        name: 'Практика заземления',
                        description: 'Возвращение в физическую реальность',
                        duration: '20 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Проводите время на природе',
                            'Занимайтесь физической активностью',
                            'Общайтесь с обычными людьми',
                            'Делайте простые бытовые дела'
                        ]
                    }
                ]
            },
            8: {
                development: [
                    {
                        name: 'Медитация изобилия',
                        description: 'Раскрытие денежного потока и материального благополучия',
                        duration: '20 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Представьте поток золотой энергии',
                            'Почувствуйте себя достойным богатства',
                            'Визуализируйте материальный успех',
                            'Аффирмация: "Я магнит для денег"'
                        ]
                    },
                    {
                        name: 'Практика справедливости',
                        description: 'Развитие честности в финансовых делах',
                        duration: 'В течение дня',
                        frequency: 'Постоянно',
                        steps: [
                            'Платите честно за услуги',
                            'Не обманывайте в деньгах',
                            'Отдавайте долги вовремя',
                            'Делитесь с нуждающимися'
                        ]
                    }
                ],
                potential: [
                    {
                        name: 'Мастер материализации',
                        description: 'Активация родовой силы создания материального богатства',
                        duration: '40 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Зажгите золотую свечу',
                            'Медитируйте на образ финансового успеха',
                            'Почувствуйте энергию денег',
                            'Составьте план реализации',
                            'Действуйте немедленно'
                        ]
                    }
                ],
                balance: [
                    {
                        name: 'Практика щедрости',
                        description: 'Преодоление страха потери и жадности',
                        duration: '15 минут',
                        frequency: '3 раза в неделю',
                        steps: [
                            'Отдайте что-то ценное безвозмездно',
                            'Помогите финансово нуждающемуся',
                            'Доверьтесь потоку изобилия',
                            'Знайте, что чем больше отдаете, тем больше получаете'
                        ]
                    }
                ]
            },
            9: {
                development: [
                    {
                        name: 'Медитация завершения',
                        description: 'Развитие способности отпускать и завершать циклы',
                        duration: '25 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Подумайте о том, что нужно отпустить',
                            'Поблагодарите за опыт',
                            'Почувствуйте освобождение',
                            'Повторяйте: "Я отпускаю с любовью"'
                        ]
                    },
                    {
                        name: 'Практика сострадания',
                        description: 'Развитие всеобъемлющей любви',
                        duration: 'В течение дня',
                        frequency: 'Постоянно',
                        steps: [
                            'Относитесь ко всем с сочувствием',
                            'Помогайте без осуждения',
                            'Прощайте искренне'
                        ]
                    }
                ],
                potential: [
                    {
                        name: 'Воин света',
                        description: 'Раскрытие способности служить высшему благу',
                        duration: '50 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Зажгите белую свечу',
                            'Медитируйте на служение миру',
                            'Представьте себя воином света',
                            'Примите свою миссию помощи людям',
                            'Действуйте с силой и состраданием'
                        ]
                    }
                ],
                balance: [
                    {
                        name: 'Практика здоровых границ',
                        description: 'Обучение говорить "нет" и не растрачивать энергию',
                        duration: '20 минут',
                        frequency: 'Ежедневно',
                        steps: [
                            'Определите свои лимиты',
                            'Не берите на себя чужие проблемы',
                            'Помогайте, не истощая себя',
                            'Наполняйтесь энергией прежде, чем отдавать'
                        ]
                    }
                ]
            }
        };

        return practicesMap[number]?.[type] || [];
    }

    // Практики для кармических долгов
    getKarmicPractices(debt) {
        const karmicMap = {
            13: [
                {
                    name: 'Практика преодоления лени',
                    description: 'Кармический долг 13 - это лень и избегание труда в прошлой жизни',
                    duration: '40 дней',
                    frequency: 'Ежедневно',
                    steps: [
                        'Вставайте в 6:00 утра ежедневно',
                        'Выполняйте трудную задачу первым делом',
                        'Не откладывайте и не прокрастинируйте',
                        'Завершайте начатые дела',
                        'Работайте усердно без жалоб'
                    ]
                },
                {
                    name: 'Медитация очищения',
                    description: 'Очищение от кармы лени',
                    duration: '30 минут',
                    frequency: 'Ежедневно вечером',
                    steps: [
                        'Зажгите белую свечу',
                        'Попросите прощения за лень прошлого',
                        'Примите обет трудолюбия',
                        'Визуализируйте очищение кармы'
                    ]
                }
            ],
            14: [
                {
                    name: 'Практика умеренности',
                    description: 'Кармический долг 14 - злоупотребление свободой и излишества',
                    duration: '40 дней',
                    frequency: 'Ежедневно',
                    steps: [
                        'Откажитесь от одной вредной привычки',
                        'Практикуйте умеренность во всем',
                        'Соблюдайте баланс работы и отдыха',
                        'Не злоупотребляйте ничем (еда, алкоголь, развлечения)',
                        'Учитесь самоконтролю'
                    ]
                },
                {
                    name: 'Медитация баланса',
                    description: 'Восстановление внутреннего равновесия',
                    duration: '25 минут',
                    frequency: 'Ежедневно',
                    steps: [
                        'Найдите центр равновесия в себе',
                        'Попросите прощения за излишества прошлого',
                        'Примите обет умеренности',
                        'Чувствуйте гармонию во всем'
                    ]
                }
            ],
            16: [
                {
                    name: 'Практика смирения',
                    description: 'Кармический долг 16 - гордыня и эгоизм в прошлой жизни',
                    duration: '40 дней',
                    frequency: 'Ежедневно',
                    steps: [
                        'Признавайте свои ошибки',
                        'Извиняйтесь искренне',
                        'Служите другим без гордости',
                        'Не хвастайтесь достижениями',
                        'Принимайте критику с благодарностью'
                    ]
                },
                {
                    name: 'Медитация разрушения эго',
                    description: 'Освобождение от гордыни',
                    duration: '35 минут',
                    frequency: 'Ежедневно',
                    steps: [
                        'Зажгите черную свечу (символ смерти эго)',
                        'Представьте разрушение ложного "я"',
                        'Попросите прощения за гордыню',
                        'Примите истинное смирение',
                        'Родитесь заново без эго'
                    ]
                }
            ],
            19: [
                {
                    name: 'Практика отдавания',
                    description: 'Кармический долг 19 - злоупотребление властью и жадность',
                    duration: '40 дней',
                    frequency: 'Ежедневно',
                    steps: [
                        'Отдавайте 10% дохода на благотворительность',
                        'Помогайте слабым и нуждающимся',
                        'Делитесь знаниями бесплатно',
                        'Не используйте власть для личной выгоды',
                        'Служите обществу'
                    ]
                },
                {
                    name: 'Медитация служения',
                    description: 'Трансформация власти в служение',
                    duration: '40 минут',
                    frequency: 'Ежедневно',
                    steps: [
                        'Зажгите золотую свечу',
                        'Попросите прощения за злоупотребление властью',
                        'Примите обет служения',
                        'Представьте себя слугой высшего блага',
                        'Используйте силу для помощи другим'
                    ]
                }
            ]
        };

        return karmicMap[debt] || [];
    }

    // Практики для планов
    getPracticesForPlane(planeName) {
        const planesPractices = {
            'Ментальный': [
                {
                    name: 'Развитие логики',
                    description: 'Тренировка ума и аналитических способностей',
                    duration: '20 минут',
                    frequency: 'Ежедневно',
                    steps: [
                        'Решайте логические задачи',
                        'Играйте в шахматы или го',
                        'Изучайте математику или философию',
                        'Анализируйте ситуации системно',
                        'Читайте научную литературу'
                    ]
                },
                {
                    name: 'Медитация ясности ума',
                    description: 'Очищение и концентрация мышления',
                    duration: '15 минут',
                    frequency: 'Утром и вечером',
                    steps: [
                        'Сядьте в тишине',
                        'Наблюдайте за мыслями без оценки',
                        'Позвольте уму успокоиться',
                        'Сфокусируйтесь на одной мысли',
                        'Развивайте концентрацию'
                    ]
                }
            ],
            'Физический': [
                {
                    name: 'Практика действия',
                    description: 'Развитие способности воплощать идеи в реальность',
                    duration: 'В течение дня',
                    frequency: 'Ежедневно',
                    steps: [
                        'Каждую идею воплощайте в действие немедленно',
                        'Занимайтесь физическими упражнениями 30 минут',
                        'Работайте руками (рукоделие, ремонт)',
                        'Завершайте начатые проекты',
                        'Создавайте материальные результаты'
                    ]
                },
                {
                    name: 'Медитация заземления',
                    description: 'Укрепление связи с физическим миром',
                    duration: '20 минут',
                    frequency: 'Ежедневно',
                    steps: [
                        'Встаньте босиком на землю',
                        'Почувствуйте энергию земли',
                        'Представьте корни, уходящие вглубь',
                        'Ощутите стабильность и силу',
                        'Вдыхайте энергию земли'
                    ]
                }
            ],
            'Эмоциональный': [
                {
                    name: 'Практика чувствования',
                    description: 'Развитие эмоционального интеллекта',
                    duration: '15 минут',
                    frequency: '3 раза в день',
                    steps: [
                        'Остановитесь и спросите себя: "Что я чувствую?"',
                        'Назовите эмоцию точно',
                        'Примите чувство без осуждения',
                        'Выразите эмоцию здоровым способом',
                        'Поделитесь чувствами с близкими'
                    ]
                },
                {
                    name: 'Медитация сердца',
                    description: 'Раскрытие сердечной чакры',
                    duration: '25 минут',
                    frequency: 'Ежедневно',
                    steps: [
                        'Положите руку на сердце',
                        'Дышите в сердце',
                        'Почувствуйте тепло и любовь',
                        'Направьте любовь ко всем существам',
                        'Оставайтесь в состоянии любви'
                    ]
                }
            ]
        };

        return planesPractices[planeName] || [];
    }

    // Родовые практики
    getAncestralPractices() {
        return [
            {
                name: 'Работа с генограммой',
                description: 'Основная практика для работы с Родом',
                duration: '9 дней',
                frequency: 'Ежедневно',
                materials: ['Генограмма', 'Свеча', 'Тихое место'],
                steps: [
                    'День 1: Нарисуйте генограмму своего Рода (минимум 3 поколения)',
                    'День 2-9: Кладите руки на генограмму и читайте молитву Роду',
                    'Держите руки на генограмме 1 минуту после молитвы',
                    'Молчите 20 минут после практики',
                    'Дайте свече догореть',
                    'На 9-й день проверьте дату: сложите все цифры',
                    'Если получилось 6 или 9 - повторите практику (второй круг)',
                    'Храните генограмму в файле, не сгибая'
                ],
                text: `Благодарю свой Род за жизнь, которую я получил(а).
Благодарю за опыт, силу и мудрость предков.
Прошу прощения за все обиды, нанесенные Роду.
Прощаю всех в Роду за боль и страдания.
Принимаю всех исключенных обратно в систему.
Восстанавливаю течение любви и силы в Роду.
Беру от Рода все благословения и таланты.
Отдаю Роду все, что не мое.
Иду дальше со светом и любовью.
Да будет так!`
            },
            {
                name: 'Практика принятия исключенных',
                description: 'Возвращение исключенных членов Рода в систему',
                duration: '2 дня',
                frequency: 'Один раз',
                steps: [
                    'Составьте список исключенных (аборты, убитые, отвергнутые)',
                    'День 1: Зажгите свечу за каждого исключенного',
                    'Скажите: "[Имя], я вижу тебя, ты принадлежишь Роду"',
                    'Почувствуйте принятие',
                    'День 2: Повторите ритуал',
                    'Добавьте: "Теперь ты на своем месте в Роду"',
                    'Ощутите целостность системы'
                ]
            },
            {
                name: 'Медитация связи с предками',
                description: 'Установление осознанной связи с Родом',
                duration: '30 минут',
                frequency: '1 раз в неделю',
                steps: [
                    'Зажгите свечу',
                    'Представьте свой Род как древо',
                    'Вы - ветвь, корни - предки',
                    'Почувствуйте силу, текущую от корней',
                    'Поблагодарите предков',
                    'Попросите их благословения и поддержки',
                    'Примите мудрость Рода'
                ]
            }
        ];
    }

    // Практики изобилия
    getAbundancePractices() {
        return [
            {
                name: 'Медитация денежного потока',
                description: 'Открытие канала изобилия',
                duration: '20 минут',
                frequency: 'Ежедневно утром',
                steps: [
                    'Сядьте удобно, спина прямая',
                    'Представьте золотой поток энергии сверху',
                    'Этот поток входит в вашу макушку',
                    'Наполняет все тело золотым светом',
                    'Повторяйте: "Я открыт(а) для изобилия"',
                    'Чувствуйте, как деньги легко приходят к вам',
                    'Визуализируйте желаемую сумму'
                ]
            },
            {
                name: 'Практика благодарности',
                description: 'Активация закона притяжения через благодарность',
                duration: '10 минут',
                frequency: 'Утром и вечером',
                steps: [
                    'Запишите 10 вещей, за которые благодарны',
                    'Почувствуйте искреннюю благодарность',
                    'Поблагодарите деньги, которые у вас есть',
                    'Поблагодарите деньги, которые придут',
                    'Чувствуйте изобилие уже сейчас'
                ]
            },
            {
                name: 'Ритуал денежного роста',
                description: 'Активация денежной энергии',
                duration: '40 дней',
                frequency: 'Ежедневно',
                materials: ['Зеленая свеча', 'Монеты', 'Купюра'],
                steps: [
                    'Зажгите зеленую свечу',
                    'Положите перед собой монеты и купюру',
                    'Читайте: "Деньги приходят ко мне легко и радостно"',
                    'Представьте умножение денег',
                    'Носите одну монету с собой всегда',
                    'Купюру положите в кошелек и не тратьте 40 дней',
                    'После 40 дней эту купюру потратьте на себя'
                ]
            }
        ];
    }

    // Получить все практики структурированно
    getAllPracticesStructured() {
        return {
            meditations: {
                name: 'Медитации',
                icon: '🧘',
                count: 27,
                items: this.getAllMeditations()
            },
            rituals: {
                name: 'Ритуалы',
                icon: '🕯️',
                count: 26,
                items: this.getAllRituals()
            },
            ancestral: {
                name: 'Работа с Родом',
                icon: '🌳',
                count: 15,
                items: this.getAncestralPractices()
            },
            abundance: {
                name: 'Изобилие',
                icon: '💰',
                count: 8,
                items: this.getAbundancePractices()
            }
        };
    }

    getAllMeditations() {
        const meditations = [];
        for (let i = 1; i <= 9; i++) {
            meditations.push(...this.getPracticesForNumber(i, 'development').filter(p => p.name.includes('Медитация')));
            meditations.push(...this.getPracticesForNumber(i, 'potential').filter(p => p.name.includes('Медитация')));
        }
        return meditations;
    }

    getAllRituals() {
        const rituals = [];
        rituals.push(...this.getAbundancePractices());
        rituals.push(...this.getAncestralPractices());
        return rituals;
    }

    // Вспомогательные функции
    sumDigits(num) {
        let sum = 0;
        const str = Math.abs(num).toString();
        for (let digit of str) {
            sum += parseInt(digit);
        }
        return sum > 9 ? this.sumDigits(sum) : sum;
    }

    getQualityName(number) {
        const qualities = {
            1: 'Лидерство и сила воли',
            2: 'Дипломатия и партнерство',
            3: 'Творчество и самовыражение',
            4: 'Стабильность и структура',
            5: 'Свобода и адаптивность',
            6: 'Гармония и любовь',
            7: 'Мудрость и духовность',
            8: 'Изобилие и власть',
            9: 'Служение и завершение'
        };
        return qualities[number] || 'Неизвестное качество';
    }
}

// Экспорт для использования в других модулях
if (typeof module !== 'undefined' && module.exports) {
    module.exports = PracticesEnhanced;
}
